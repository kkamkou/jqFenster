/*!
 * jqFenster - Lightweight Modal Framework
 * Version: 1.0 (2012-10-03)
 * https://github.com/kkamkou/jqFenster
 */
(function(e){(function(e){var t=function(e,t){this.holder=e.data("jqFensterHolder")||null,this.element=e,this.setOptions(t),!this.options.selector&&this.element.selector&&(this.options.selector=this.element.selector),this.element.hasClass("jqFenster")||(this.element.addClass("jqFenster"),this._init())};t.prototype={close:function(){return this.getHolder()&&(this.getHolder().trigger("jqFensterClose"),this.setHolder(null)),this},open:function(){return this.getHolder()?this:this.setHolder(this.element.trigger("click").data("jqFensterHolder"))},reInit:function(){this.close();var e=this;return setTimeout(function(){e._init().open()},100),this},getHolder:function(){return this.holder},getAncestor:function(){return this.getHolder()?this.getHolder().data("jqFensterAncestor"):null},setHolder:function(e){return this.holder=e,this},setOptions:function(t){return this.options=e.extend({href:null,selector:null,options:null},t||{}),this},_init:function(){return this.options.href!==null&&this.element.data("href",this.options.href),this.options.selector!==null&&this.element.data("selector",this.options.selector),this.options.options&&this.element.data("options",this.options.options),this}},e.fn.fenster=function(e){return new t(this,e)},e.extend({fensterFinder:function(t){var n=e(t),r=null;return n.data("jqFensterHolder")?n.fenster(n.data("options")):(r=n.closest(".jqFensterHolder"),r.length?e(r.data("jqFensterAncestor")).fenster():null)},fenster:function(t){var n=e("<a />",{css:{display:"none"}});return e("body").append(n),e.type(t)==="string"&&(t={selector:t}),e(n).fenster(t)}})})(jQuery),function(e,t,n){n.jqFensterOptions={noOverlay:!1,animationSpeed:0,callbackOpen:null,callbackClose:null,template:null},n.jqFensterOptions.template={prepare:function(){return this.children().hide()},inject:function(e){this.empty().append(e)},cleanupRemote:function(){return this.remove()},cleanupSelector:function(){return this.children().hide().unwrap()}};var r=function(e,r){this.overlay=null,this.options=n.extend({},e),this.element=r,this.holder=null,this._init=function(){var e=this;this.holder=n("<div/>").addClass("jqFensterHolder"),n.data(this.holder.get(0),"jqFenster",this);if(r.data("options")){try{n.extend(this.options,n.type(r.data("options"))==="object"?r.data("options"):n.parseJSON(r.data("options").replace(/([a-zA-Z]+):/g,'"$01":')))}catch(i){n.error(["jqFenster: incorrect JSON provided (check the code of a link)",r,i.toString()])}n.type(this.options.callbackOpen)==="string"&&(this.options.callbackOpen=t[this.options.callbackOpen]),n.type(this.options.callbackClose)==="string"&&(this.options.callbackClose=t[this.options.callbackClose])}n.isFunction(this.options.callbackOpen)&&this.holder.bind("jqFensterCallbackOpen",function(){return e.options.callbackOpen(e.getElement())}),n.isFunction(this.options.callbackClose)&&this.holder.bind("jqFensterCallbackClose",function(){return e.options.callbackClose(e.getElement())})}};r.prototype={getHolder:function(){return this.holder},getElement:function(){return this.element},getOverlay:function(){return this.overlay},open:function(){if(this.isLocked())return!1;this._init(),this.setLock(!0),n("body").append(this.getHolder());if(this.getElement().data("selector"))return this.create(n(this.getElement().data("selector")));var e=this;return this.options.template.loaderShow.call(this.getHolder()),n.get(this.getElement().data("href")||this.getElement().attr("href")).done(function(t){e.options.template.loaderRemove.call(e.getHolder()),e.create(t)}),this},show:function(){var e=this.options.template.prepare.call(this.getHolder());if(!e.height()){var t=this;return setTimeout(function(){t.show()},30),this}return this.getHolder().children().css("width",e.width()),e.show(),this},create:function(e){var t=this,r=this.getHolder(),i=this.getElement(),s=this.options.template.inject.call(r,e);return this.show(),r.bind("jqFensterClose",function(){return n.type(t.getOverlay())==="object"&&(t.getOverlay().close(),t.setOverlay(null)),t.close()}),r.find(".jqFensterClose").bind("click",function(){return r.trigger("jqFensterClose"),!1}),r.data("jqFensterAncestor",i),i.data("jqFensterHolder",r),!this.options.noOverlay&&n.type(n.fn.jqEbony)!=="undefined"?this.setOverlay(n(r).jqEbony({clickCloseArea:s,animationSpeed:this.options.animationSpeed,callbackClose:function(){return t.close.apply(n.data(this.getElement().get(0),"jqFenster"))},callbackOpen:function(){return r.trigger("jqFensterCallbackOpen")}}).open()):r.fadeIn(this.options.animationSpeed,function(){r.trigger("jqFensterCallbackOpen")}),!1},close:function(){var e=this.getElement(),t=this.getHolder(),r=this;return t.fadeOut(r.getOverlay()?0:r.options.animationSpeed,function(){t.trigger("jqFensterCallbackClose"),n.proxy(e.data("selector")?r.options.template.cleanupSelector:r.options.template.cleanupRemote,n(this))(),e.removeData("jqFensterLocked").removeData("jqFensterHolder")}),this},isLocked:function(){return this.getElement().data("jqFensterLocked")},setLock:function(e){return this.getElement().data("jqFensterLocked",!!e)},setOverlay:function(e){return this.overlay=e,this}},n(".jqFenster").live("click",function(e){return(new r(n.jqFensterOptions,n(this))).open(),!1})}(document,window,jQuery),function(e){e.jqFensterOptions.template={prepare:function(){return this.find("td.jqFensterContent").children().hide()},inject:function(e){return this.append('<table class="jqFensterContainer"><tr><td class="jqFensterContent"></td></tr></table>').find("td.jqFensterContent").append(e)},cleanupRemote:function(){return this.remove()},cleanupSelector:function(){return this.parent().append(this.find("td.jqFensterContent").children().hide()),this.remove()},loaderShow:function(){return this.append('<div class="jqFensterLoading"><p></p></div>')},loaderRemove:function(){return this.find("div.jqFensterLoading").remove()}}}(jQuery)})(jQuery)